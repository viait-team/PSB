<!DOCTYPE html>
<html>

<head>
    <title>SVGX Personal Signature Block (PSB)</title>
    <!-- INCLUDE D3.JS LIBRARY -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            color: #333;
        }

        .main-container,
        .analysis-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .panel {
            border: 2px solid #ccc;
            width: 600px;
            height: 300px;
        }

        #signature-canvas {
            cursor: crosshair;
            touch-action: none;
        }

        #preview-panel {
            background-color: #f8f8f8;
        }

        .chart-panel {
            border: 1px solid #ddd;
        }

        .button-group {
            margin-top: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .button-group button {
            padding: 8px 12px;
            font-size: 14px;
            margin-right: 10px;
        }

        h3 {
            margin-bottom: 5px;
        }

        /* D3 Chart Styles */
        .chart-line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }

        .chart-axis path,
        .chart-axis line {
            stroke: #aaa;
        }

        .chart-axis text {
            fill: #555;
            font-size: 10px;
        }

        .chart-title {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
        }

        .scrubber-line {
            stroke: red;
            stroke-width: 1px;
        }

        #floating-panel {
            position: fixed;
            top: 20px;
            right: 20px; /* Initial anchor */
            background: #fff;
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 999;
            cursor: move;
            display: flex;
            flex-direction: row; /* Horizontal layout */
            gap: 10px;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .icon-button:hover {
            background: #eee;
        }
    </style>
</head>

<body>
    <h1>VIAIT Forensic Analysis Studio</h1>

    <!-- 1. TOP SECTION: INPUT AND PREVIEW -->
    <div class="main-container">
        <div>
            <h3>1. Signing Canvas</h3>
            <svg id="signature-canvas" class="panel"></svg>
        </div>
        <div>
            <h3>2. Signature Replay</h3>
            <div id="preview-panel" class="panel"></div>
        </div>
    </div>

    <!-- 2. MIDDLE SECTION: ACTION BUTTONS -->
    <div class="button-group" style="visibility:hidden;">
        <button id="generate-button">Generate & Analyze</button>
        <button id="upload-button">Upload & Analyze</button>
        <button id="download-button" disabled>Download SVG</button>
        <button id="reset-button">Reset</button>
    </div>
    
    <hr/>

    <!-- 3. BOTTOM SECTION: FORENSIC ANALYSIS CHARTS -->
    <div class="analysis-container">
        <div>
            <h3>s(t) - Displacement</h3>
            <svg id="st-chart" class="panel chart-panel"></svg>
        </div>
        <div>
            <h3>v(s) - Velocity</h3>
            <svg id="vs-chart" class="panel chart-panel"></svg>
        </div>
    </div>

    <!-- Floating Icon Button Panel -->
    <div id="floating-panel">
        <button class="icon-button" title="Generate & Analyze" onclick="document.getElementById('generate-button').click()">‚öôÔ∏è</button>
        <button class="icon-button" title="Upload & Analyze" onclick="document.getElementById('upload-button').click()">üì§</button>
        <button class="icon-button" title="Download SVG" onclick="document.getElementById('download-button').click()">üíæ</button>
        <button class="icon-button" title="Reset" onclick="document.getElementById('reset-button').click()">üîÑ</button>
        <button class="icon-button" title="Preview Panel" onclick="togglePreview()">üëÅÔ∏è</button>
        <button class="icon-button" title="s(t) Chart" onclick="toggleChart('st-chart')">üìà</button>
        <button class="icon-button" title="v(s) Chart" onclick="toggleChart('vs-chart')">üìâ</button>
    </div>

    <!-- Hidden elements -->
    <textarea id="output-svg" style="display: none;" readonly></textarea>
    <input type="file" id="file-input" accept="image/svg+xml" style="display: none;" />

    <script>

        (function makeDraggableHorizontal() {
            const panel = document.getElementById('floating-panel');
            let offsetX, isDragging = false;

            panel.addEventListener('mousedown', (e) => {
                isDragging = true;
                // Convert right to left for dragging
                panel.style.left = `${panel.getBoundingClientRect().left}px`;
                panel.style.right = 'auto';
                offsetX = e.clientX - panel.offsetLeft;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    panel.style.left = `${e.clientX - offsetX}px`;
                }
            });

            document.addEventListener('mouseup', () => isDragging = false);
        })();


        // Toggle visibility of preview panel
        function togglePreview() {
            const preview = document.getElementById('preview-panel');
            preview.style.display = (preview.style.display === 'none') ? 'block' : 'none';
        }

        // Toggle visibility of chart panels
        function toggleChart(chartId) {
            const chart = document.getElementById(chartId);
            chart.style.display = (chart.style.display === 'none') ? 'block' : 'none';
        }
    </script>
    <script src="psb-creator.js"></script>
</body>

</html>